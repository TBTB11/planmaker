# 機能仕様リファレンス

ユーザーストーリー・画面フローは `docs/planning/03_USER_STORIES_AND_FLOW.md` を参照。
本ドキュメントはユーザーストーリーに含まれない**仕様レベルの定義**のみを記載する。

---

## 1. 進捗ステータス定義

| ステータス | 説明 | 次のアクション |
|-----------|------|-------------|
| 未着手 | まだ取り組んでいない | 計画に組み込み、導入を開始 |
| 導入済み | 説明・解説は完了 | 演習問題に進む |
| 演習中 | 問題演習の段階 | 定着度を確認 |
| 定着確認待ち | テスト等で確認予定 | テスト実施後に判定 |
| 完了 | 十分に定着 | 次の単元へ（定期的に復習チェック） |
| 要復習 | 再度取り組みが必要 | 復習を計画に組み込む |
| 保留 | 他の単元を優先 | タイミングを見て再開 |

### 完了→要復習への移行条件

| 条件 | 詳細 | 判定方法 |
|------|------|---------|
| 時間経過 | 完了から設定期間が経過 | 自動判定 + AI予測 |
| 定着度低下 | 関連単元の理解度が低い | AI分析 |
| テスト結果 | 該当単元の得点が低い | 自動判定 |
| 手動変更 | 講師の判断 | ユーザー操作 |

---

## 2. 予想点数計算ロジック

### 計算要素

| 要素 | データソース |
|------|------------|
| 単元別ウェイト（配点比率） | 入力あり→使用、なし→均等配分 |
| ステータス別期待値 | システムデフォルト + 調整可能 |
| 未着手部分の期待値 | ユーザー入力 or 過去テストから予測 |
| 目標までの残り時間 | 完了見込み単元数を加味（自動計算 + AI予測） |

### ステータス別の得点期待率（デフォルト値）

| ステータス | 期待率 | 備考 |
|-----------|-------|------|
| 完了 | 90〜100% | 定着済み |
| 定着確認待ち | 70〜80% | ほぼ習得 |
| 演習中 | 50〜60% | 理解途中 |
| 導入済み | 30〜40% | 概念理解のみ |
| 要復習 | 40〜50% | 以前は理解していた |
| 未着手 | 0〜?% | ユーザー入力 or 過去テストから予測 |
| 保留 | 0〜10% | 未学習扱い |

---

## 3. アラート定義

| レベル | アラート名 | 発生条件 |
|-------|----------|---------|
| 🔴 危険 | 目標点未達見込み | 予想点数が目標点を下回る |
| 🔴 危険 | 進捗大幅遅延 | 計画より2週間以上遅れ |
| 🟡 注意 | 復習単元蓄積 | 要復習ステータスが3個以上 |
| 🟡 注意 | 進捗遅延 | 計画より1週間遅れ |
| 🟡 注意 | 完了単元の復習時期 | 完了から設定期間が経過 |
| 🔵 情報 | 季節講習提案 | 季節講習の検討時期 |
| 🔵 情報 | 目標期日接近 | 目標期日まで1ヶ月未満 |

---

## 4. AI補完仕様

### 4.1 補完対象項目

| 項目 | アプローチ | 信頼度 |
|------|----------|-------|
| 単元リスト・順序 | 一般情報ベース | 高 |
| 目標期日 | 一般情報ベース | 高 |
| 単元の予定回数 | ハイブリッド | 中〜高 |
| 配点ウェイト | 一般情報ベース | 中 |
| 理解度予測 | 過去データベース | 中〜高 |
| 進捗ステータス提案 | 過去データベース | 中〜高 |
| コメント定型文 | 過去データベース | 中 |
| 次回予定単元 | 過去データベース | 高 |
| 季節講習回数 | ハイブリッド | 中 |
| 復習タイミング | ハイブリッド | 中〜高 |
| 未着手部分期待値 | 過去データベース | 高 |

### 4.2 AI質問の発生条件

| 条件 | 質問例 |
|------|-------|
| 信頼度が低い | 「理解度は3で合っていますか？」 |
| 過去データと矛盾 | 「前回は理解度5→今回2。特別な事情がありましたか？」 |
| 重要な判定 | 「完了にしますか？復習が必要になる可能性が高いです」 |
| 異常値検出 | 「予定回数1回ですが、通常3-4回かかります」 |
| 曖昧な入力 | 「小学校の分数と中学校の分数計算のどちらですか？」 |
| コンテキスト不足 | 「目標点を設定していません。教えてください」 |

### 4.3 ハイブリッド補完の重み付け

| データ蓄積量 | 一般情報 | 過去データ |
|-------------|---------|----------|
| 新規（0件） | 100% | 0% |
| 少量（1-5件） | 70% | 30% |
| 中程度（6-15件） | 40% | 60% |
| 十分（16件以上） | 20% | 80% |

---

## 5. コンテキスト管理

生徒ごとのAI補完精度向上のための文脈情報。

| カテゴリ | 要素 | 更新タイミング |
|---------|------|-------------|
| 基本プロファイル | 学年、目標タイプ、科目、目標期日 | 初回設定時、変更時 |
| 学習特性 | 得意/苦手分野、理解速度の傾向 | 授業記録蓄積時（自動分析） |
| 進捗パターン | 平均習得回数、復習必要度の傾向 | 進捗更新時（自動分析） |
| テスト傾向 | 単元別得点率、未学習範囲の得点傾向 | テスト結果入力時 |
| 行動パターン | 宿題実施率、授業間隔の影響 | 授業記録蓄積時（自動分析） |
| 講師メモ | 特記事項 | 講師の任意入力時 |

### コンテキスト操作

- **確認**: AIが生成したコンテキストを閲覧
- **補正**: AIの分析が実態と異なる場合に講師が修正
- **追加**: AIでは把握できない情報を特記事項として追加
- **リセット**: コンテキストのみ削除可能（入力履歴は保持）

---

## 6. 出力・レポート機能

### ガントチャート

- ゴールまでの全体像を可視化
- 複数の進捗予測（楽観/標準/悲観）を表示
- 各予測パターンでの予想点数も併記
- 進捗入力のたびに自動更新

### 授業報告メモ（自動生成）

- 入力: 実施単元、理解度、コメント
- AIが報告文を生成（生徒の学習特性に合わせた表現）
- 講師が確認・編集して確定

### 保護者向けレポート（PDF）/ 講師引き継ぎ資料（PDF）

- 定期的に保護者へ共有するレポート
- 担当変更時の引き継ぎ情報（AIコンテキスト含む）

---

## 7. データ管理

| 方式 | 用途 |
|------|-----|
| ブラウザ内保存（IndexedDB） | 自動保存（即時反映） |
| JSONエクスポート/インポート | バックアップ、端末間移行 |

### 変更履歴の記録

- 変更日時、変更内容、変更理由（任意）、入力元（ユーザー / AI確定 / AI自動）

### 過去テストデータ

- 入力: テスト種別、日付、点数、範囲となる単元
- 用途: 未着手部分の期待値予測、予想点数の精度向上
- 任意入力（入力があれば予測精度が向上）

---

## 8. 非機能要件

| カテゴリ | 要件 |
|---------|------|
| パフォーマンス | AI補完は2秒以内に表示 |
| データ保護 | 生徒番号のみ使用、個人情報は別管理 |
| オフライン対応 | ブラウザ保存データで基本機能は動作 |
| ブラウザ対応 | Chrome, Safari, Firefox の最新版 |
| レスポンシブ | タブレットでの操作に対応 |

---

## 9. 将来の拡張機能（検討中）

- 単元の依存関係管理（前提知識の順序）
- 優先度スコア表示（「次にやるべき単元」の提案）
- テスト範囲マッピング（対策漏れ防止）
- 授業回数の消化率可視化
- メール/プッシュ通知（アラート外部通知）
- 類似生徒パターン活用（高度な予測）
